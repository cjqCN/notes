# 缓存雪崩、击穿、穿透

## 1 问题
以redis为例，解决常见的缓存问题。
- 缓存雪崩
- 缓存击穿
- 缓存穿透


### 1.1 雪崩
#### 1.1.1 定义
缓存雪崩是指在设置缓存（多个key同时设置）采用了相同的过期时间（或者缓存系统宕机），导致大量缓存在某一时刻同时失效，高并发情况下请求全部转发到DB，DB瞬时压力过大。
#### 1.1.2 解决方法
- 通过查询队列或者加锁，减缓数据库的压力。（编码难度较大，性能损耗严重）
- 设置缓存时增加一个随机时间，避免缓存同时失效。（推荐，但在请求在时间分布上极不均匀的情况下仍然会出现雪崩现象）
- 缓存时间设置为-1。（脏数据问题严重）


### 1.2 缓存击穿
#### 1.2.1 定义
在缓存（单个热点key）失效的同时收到大量的查询请求，请求全部转发到DB，DB瞬时压力过大。
#### 1.2.2 解决方法
- 采用互斥锁，在缓存未命中的时候先获取锁再去数据库load数据，从而避免多线程同时去load数据。（编码难度大，容易出现线程池阻塞）
- 维护一个刷新时间，在读取缓存的时候做检查，如缓存未过期但过了刷新时间的时候，刷新它的过期时间。(没有真正解决问题，缓存仍会出现过期的情况)
- 缓存时间设置为-1。（脏数据问题严重）
- 采用降级策略。（部分请求不读数据库，做降级处理。要维护降级逻辑）


### 1.3 缓存穿透
#### 1.3.1 定义
大量请求同时查询一个不存在的key，缓存一直不能命中，请求全部转发到DB，DB瞬时压力过大。
#### 1.3.2 解决方法
- 采用布隆过滤器。（省空间，有编码难度）
- 将不存在的结果放置缓存。（推荐，数据插入或者占用空间过大时需要及时删除缓存）


